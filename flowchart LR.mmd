flowchart LR
  %% Developer lane
  subgraph Developer
    D1([Start]) --> D2([Developer creates Pull Request])
  end

  %% CI lane
  subgraph CI
    D2 --> C1[CI: Lint → Test → Build & Tag]
    C1 --> C2{CI OK?}
    C2 -- No --> C3([Notify Developer])
    C2 -- Yes --> C4([Push Docker Image to Registry])
  end

  %% Kargo lane
  subgraph Kargo
    C4 --> K1([Warehouse discovers new image tag])
    K1 --> K2([Update env/dev values → Git])
  end

  %% GitOps lane
  subgraph GitOps
    K2 --> G1([Argo CD sync Dev])
    G1 --> G2{Dev Deployment Healthy?}
    G2 -- No --> G3([Notify & rollback?])
    G2 -- Yes --> S1([Update env/staging values → Git])
    S1 --> G4([Argo CD sync Staging])
    G4 --> G5{Staging Approval Granted?}
    G5 -- No --> G6([Notify for approval])
    G5 -- Yes --> P1([Update env/prod values → Git])
    P1 --> G7([Argo CD sync Prod])
    G7 --> End([End])
  end

  %% Styling
  classDef decision fill:#fdd,stroke:#f00,stroke-width:2px;
  classDef process fill:#dfd,stroke:#080,stroke-width:1px;
  classDef notify fill:#fdf,stroke:#808,stroke-width:1px;

  class C2,G2,G5 decision;
  class C1,C4,K1,K2,G1,S1,G4,P1,G7 process;
  class C3,G3,G6 notify;